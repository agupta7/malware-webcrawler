from weighted_knn import WeightedKnn
from collections import deque

def leaveOneOutExperiment(dataset, k, b, featureMask):
    dataset = deque(dataset)
    stats = {'tp': 0, 'tn': 0, 'fp': 0, 'fn': 0}

    for i in range(len(dataset)):
        instance = dataset.popleft()

        wkn = WeightedKnn(dataset, k, b, featureMask)
        prediction = wkn.predict(instance['featureVector'])
        prediction = round((prediction + 1) / 2.0) * 2 - 1
        if instance['output'] == 1:
            if prediction == 1:
                stats['tp'] += 1
            else:
                stats['fn'] += 1
        else:
            if prediction == -1:
                stats['tn'] += 1
            else:
                stats['fp'] += 1
        dataset.append(instance)

    accuracy = float(stats['tp'] + stats['tn']) / sum(stats.values())
    stats['accuracy'] = accuracy
    return stats

