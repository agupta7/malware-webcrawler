#!/usr/bin/python -uB
import weightedknn.weighted_knn as wknn
from assignment2 import loadDataset
import numpy as np
import sys
import pickle
from onlineClassifiers.URLVoid import URLVoid

def findURLsInRange(dataset, unigramList, lower, upper):
    idealK = len(dataset)
    idealB = 10
    idealFeatureMask = np.ones(95)

    knn = wknn.WeightedKnn(dataset, idealK, idealB, idealFeatureMask)
    for link in unigramList:
        prediction = knn.predict(link['unigram'])
        if prediction > lower and prediction <= upper:
            print "URL {0} has a prediction of {1}".format(link['url'], prediction)
def predict(dataset, unigram):
    idealK = len(dataset) - 1
    idealB = 10
    idealFeatureMask = np.ones(95)

    knn = wknn.WeightedKnn(dataset, idealK, idealB, idealFeatureMask)
    return knn.predict(unigram)

def treeToList(unigramTree, unigramList = []):
    unigramList = unigramList or []
    if unigramTree is None:
        return []
    for link in (unigramTree['links'] or []):
        unigramList.append(link)
        treeToList(link, unigramList)
    return unigramList

if __name__ == "__main__":
    if len(sys.argv) < 4:
        print >> sys.stderr, "Usage: {0} dataset_file urllist_file unigrams...".format(sys.argv[0])
        sys.exit()
    dataset = loadDataset(sys.argv[1])
    urllist = open(sys.argv[2]).read().split('\n')[:-1]
    unigramFiles = sys.argv[3:]


    unigramList = []

    for rootURL in unigramFiles:
        if '.unigram' in rootURL:
            unigramTree = pickle.load(open(rootURL, 'rb'))
            unigramList.extend(treeToList(unigramTree))

    for unigram in unigramList:
        if unigram['url'] in urllist:
            print unigram['url'] + " ----- " + str(predict(dataset, unigram['unigram']))
           #classification = URLVoid().classify(unigram['url']) 
           #print unigram['url'] + ', ' + str(classification) + ', ' + str(unigram['unigram'])[1:-1]
